
<div align="center">

![:name](https://count.getloli.com/@astrbot_plugin_outputpro?name=astrbot_plugin_outputpro&theme=minecraft&padding=6&offset=0&align=top&scale=1&pixelated=1&darkmode=auto)

# astrbot_plugin_outputpro

_✨ 输出增强 ✨_  

[![License](https://img.shields.io/badge/License-MIT-green.svg)](https://opensource.org/licenses/MIT)
[![Python 3.10+](https://img.shields.io/badge/Python-3.10%2B-blue.svg)](https://www.python.org/)
[![AstrBot](https://img.shields.io/badge/AstrBot-3.4%2B-orange.svg)](https://github.com/Soulter/AstrBot)
[![GitHub](https://img.shields.io/badge/作者-Zhalslar-blue)](https://github.com/Zhalslar)

</div>

## 🤝 介绍

OutputPro 作用于 AstrBot **发送前**的“最后一公里”，把一条消息从原始文本到最终呈现拆成 12 个可独立开关的阶梯。  
阶梯顺序 = 配置里的 `pipeline.steps`，默认自上而下执行：

| 阶梯 | 配置键名 | 一句话职责 | 可关闭 | 仅 LLM 生效 |
| ---- | -------- | ---------------- | ------ | ------------ |
| ① 图片外显 | `summary` | 图片消息先“骗”个金句预览 | ✅ | ❌ |
| ② 报错拦截 | `error` | 全局报错拦截或私聊转发 | ✅ | ❌ |
| ③ 复读拦截 | `dedup` | 复读式内容直接合并 | ✅ | ✅ |
| ④ 人机拦截 | `block_ai` | AI 腔/官方腔一键拦 | ✅ | ✅ |
| ⑤ 解析艾特 | `parse_at` | 假@转真@，再按概率留/删 | ✅ | ✅ |
| ⑥ 文本清洗 | `clean` | 刮括号、emoji、前缀后缀 | ✅ | ✅ |
| ⑦ 文转语音 | `tts` | 文转语音（QQ 声聊） | ✅ | ✅ |
| ⑧ 文转图片 | `t2i` | 长文自动转图片 | ✅ | ✅ |
| ⑨ 智能引用 | `reply` | 插嘴多时自动带原消息 | ✅ | ✅ |
| ⑩ 合并转发 | `forward` | 超长内容合并转发 | ✅ | ❌ |
| ⑪ 自动撤回 | `recall` | 关键词触发 N 秒后撤回 | ✅ | ❌ |
| ⑫ 分段回复 | `split` | 按符号拆多条延迟发 | ✅ | ✅ |

> 想改顺序？把 `pipeline.lock_order` 设成 `false`，然后 UI 拖拽即可。  
> 想让某一步只对 LLM 生效？在 `pipeline.llm_steps` 里勾选对应阶梯即可。

---

### ① 图片外显

“封面标题党”——单张图片消息把“[图片]”替换成随机金句，群列表就能先看到字（aiocqhttp 专属）。  
金句库可自定义，一行一句，随机抽取。

### ② 报错拦截

“错误消音器”——Bot 返回内容一旦命中关键词（如“请求失败”“出现异常”）立即拦截，可选：

- `block` 直接吞掉  
- `forward` 私聊转发给管理员  
- `ignore` 什么都不做

### ③ 复读拦截

“防刷合并”——短时间内内容完全重复自动屏蔽，减少人机流口水现象。  
（默认开启，无额外配置，可关）

### ④ 人机拦截

“官腔过滤器”——消息里出现“作为 AI 助手”“感谢您的理解”等典型人机句时整段拦掉，关键词列表可自定义。  
只对 LLM 输出生效，避免把官方模板发给用户。

### ⑤ 解析艾特

“@修复器”——句首手动打的“@昵称”自动转成真@，再按设定概率决定保留或删除，解决“空格被吃”问题。  
概率 0=全部删除，1=全部保留，0.01≈百分之一几率留。

### ⑥ 文本清洗

“文本美容”——按顺序摘除中括号、小括号、情绪标签、emoji、句首/句尾多余符号，并支持正则整体清洗。  
只对短于设定字符数的消息生效（默认 150），长文跳过防止误伤。

### ⑦ 文转语音

“一键配音”——基于 QQ 声聊官方接口，零部署零密钥，把文字变语音。  

- 20+ 角色可选（小新、猴哥、霸总、妲己…）  
- 超长文本自动跳过  
- 需填一个“中转群”群号，可隐藏 AI 标识  
- 触发概率可调，0=关闭

### ⑧ 文转图片

“长文截图”——基于 pillowmd 轻量渲染，把超长文本自动变图片。  

- 阈值可调，0=关闭  
- 支持自定义样式目录、黄金分割自动分页  
- 重载插件时可自动清缓存

### ⑨ 智能引用

“插嘴追踪”——当 Bot 要回复的那条消息被其他人插队 N 条以上时，自动带上原消息引用，防止上下文断裂。  
阈值 0=完全关闭；1=插 1 条就引用。

### ⑩ 合并转发

“合并转发”——继续超长就自动打包成转发消息，节点昵称可自定义，留空则使用 Bot 当前昵称。  
（aiocqhttp 专属）

### ⑪ 自动撤回

“后悔药”——检测到敏感关键词（如“我叫”“我住在”）后延迟 N 秒自动撤回，避免隐私/测试泄露。  

### ⑫ 分段回复

“节奏发送”——按指定符号（。？！\n 等）把长消息拆成多条，线性插值延迟 1.5→3.5 s，模拟真人打字。  
可设最大段数，防止刷屏。

---

### 附：跨阶梯通用规则

1. 仅对 LLM 生效的阶梯已在 `pipeline.llm_steps` 默认勾选，普通插件消息会直接跳过这些步骤，节省性能。  
2. 任何阶梯返回“拦截”后，后续步骤立即终止，消息不会发出。

## 📦 安装

在astrbot的插件市场搜索astrbot_plugin_outputpro，点击安装即可

## ⌨️ 使用说明

请前往配置中查看

### 示例图

## 👥 贡献指南

- 🌟 Star 这个项目！（点右上角的星星，感谢支持！）
- 🐛 提交 Issue 报告问题
- 💡 提出新功能建议
- 🔧 提交 Pull Request 改进代码

## 📌 注意事项

- 想第一时间得到反馈的可以来作者的插件反馈群（QQ群）：460973561（不点star不给进）
